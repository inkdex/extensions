"use strict";var source=(()=>{var li=Object.create;var ue=Object.defineProperty;var ci=Object.getOwnPropertyDescriptor;var pi=Object.getOwnPropertyNames;var di=Object.getPrototypeOf,hi=Object.prototype.hasOwnProperty;var fi=(r,e)=>()=>(r&&(e=r(r=0)),e);var g=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Pe=(r,e)=>{for(var t in e)ue(r,t,{get:e[t],enumerable:!0})},rt=(r,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of pi(e))!hi.call(r,n)&&n!==t&&ue(r,n,{get:()=>e[n],enumerable:!(i=ci(e,n))||i.enumerable});return r};var z=(r,e,t)=>(t=r!=null?li(di(r)):{},rt(e||!r||!r.__esModule?ue(t,"default",{value:r,enumerable:!0}):t,r)),gi=r=>rt(ue({},"__esModule",{value:!0}),r);var ot=g(le=>{"use strict";a();le.byteLength=yi;le.toByteArray=Ii;le.fromByteArray=Si;var $=[],O=[],mi=typeof Uint8Array<"u"?Uint8Array:Array,Fe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(G=0,it=Fe.length;G<it;++G)$[G]=Fe[G],O[Fe.charCodeAt(G)]=G;var G,it;O[45]=62;O[95]=63;function nt(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var i=t===e?0:4-t%4;return[t,i]}function yi(r){var e=nt(r),t=e[0],i=e[1];return(t+i)*3/4-i}function wi(r,e,t){return(e+t)*3/4-t}function Ii(r){var e,t=nt(r),i=t[0],n=t[1],o=new mi(wi(r,i,n)),s=0,c=n>0?i-4:i,p;for(p=0;p<c;p+=4)e=O[r.charCodeAt(p)]<<18|O[r.charCodeAt(p+1)]<<12|O[r.charCodeAt(p+2)]<<6|O[r.charCodeAt(p+3)],o[s++]=e>>16&255,o[s++]=e>>8&255,o[s++]=e&255;return n===2&&(e=O[r.charCodeAt(p)]<<2|O[r.charCodeAt(p+1)]>>4,o[s++]=e&255),n===1&&(e=O[r.charCodeAt(p)]<<10|O[r.charCodeAt(p+1)]<<4|O[r.charCodeAt(p+2)]>>2,o[s++]=e>>8&255,o[s++]=e&255),o}function xi(r){return $[r>>18&63]+$[r>>12&63]+$[r>>6&63]+$[r&63]}function Ei(r,e,t){for(var i,n=[],o=e;o<t;o+=3)i=(r[o]<<16&16711680)+(r[o+1]<<8&65280)+(r[o+2]&255),n.push(xi(i));return n.join("")}function Si(r){for(var e,t=r.length,i=t%3,n=[],o=16383,s=0,c=t-i;s<c;s+=o)n.push(Ei(r,s,s+o>c?c:s+o));return i===1?(e=r[t-1],n.push($[e>>2]+$[e<<4&63]+"==")):i===2&&(e=(r[t-2]<<8)+r[t-1],n.push($[e>>10]+$[e>>4&63]+$[e<<2&63]+"=")),n.join("")}});var st=g(Oe=>{a();Oe.read=function(r,e,t,i,n){var o,s,c=n*8-i-1,p=(1<<c)-1,l=p>>1,d=-7,h=t?n-1:0,x=t?-1:1,S=r[e+h];for(h+=x,o=S&(1<<-d)-1,S>>=-d,d+=c;d>0;o=o*256+r[e+h],h+=x,d-=8);for(s=o&(1<<-d)-1,o>>=-d,d+=i;d>0;s=s*256+r[e+h],h+=x,d-=8);if(o===0)o=1-l;else{if(o===p)return s?NaN:(S?-1:1)*(1/0);s=s+Math.pow(2,i),o=o-l}return(S?-1:1)*s*Math.pow(2,o-i)};Oe.write=function(r,e,t,i,n,o){var s,c,p,l=o*8-n-1,d=(1<<l)-1,h=d>>1,x=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,S=i?0:o-1,v=i?1:-1,F=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(c=isNaN(e)?1:0,s=d):(s=Math.floor(Math.log(e)/Math.LN2),e*(p=Math.pow(2,-s))<1&&(s--,p*=2),s+h>=1?e+=x/p:e+=x*Math.pow(2,1-h),e*p>=2&&(s++,p/=2),s+h>=d?(c=0,s=d):s+h>=1?(c=(e*p-1)*Math.pow(2,n),s=s+h):(c=e*Math.pow(2,h-1)*Math.pow(2,n),s=0));n>=8;r[t+S]=c&255,S+=v,c/=256,n-=8);for(s=s<<n|c,l+=n;l>0;r[t+S]=s&255,S+=v,s/=256,l-=8);r[t+S-v]|=F*128}});var _t=g(Z=>{"use strict";a();var Ue=ot(),K=st(),at=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;Z.Buffer=u;Z.SlowBuffer=Mi;Z.INSPECT_MAX_BYTES=50;var ce=2147483647;Z.kMaxLength=ce;u.TYPED_ARRAY_SUPPORT=_i();!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function _i(){try{let r=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(r,e),r.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}});Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function q(r){if(r>ce)throw new RangeError('The value "'+r+'" is invalid for option "size"');let e=new Uint8Array(r);return Object.setPrototypeOf(e,u.prototype),e}function u(r,e,t){if(typeof r=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return $e(r)}return pt(r,e,t)}u.poolSize=8192;function pt(r,e,t){if(typeof r=="string")return bi(r,e);if(ArrayBuffer.isView(r))return Ai(r);if(r==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r);if(k(r,ArrayBuffer)||r&&k(r.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(k(r,SharedArrayBuffer)||r&&k(r.buffer,SharedArrayBuffer)))return Ce(r,e,t);if(typeof r=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let i=r.valueOf&&r.valueOf();if(i!=null&&i!==r)return u.from(i,e,t);let n=Bi(r);if(n)return n;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof r[Symbol.toPrimitive]=="function")return u.from(r[Symbol.toPrimitive]("string"),e,t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r)}u.from=function(r,e,t){return pt(r,e,t)};Object.setPrototypeOf(u.prototype,Uint8Array.prototype);Object.setPrototypeOf(u,Uint8Array);function dt(r){if(typeof r!="number")throw new TypeError('"size" argument must be of type number');if(r<0)throw new RangeError('The value "'+r+'" is invalid for option "size"')}function Ri(r,e,t){return dt(r),r<=0?q(r):e!==void 0?typeof t=="string"?q(r).fill(e,t):q(r).fill(e):q(r)}u.alloc=function(r,e,t){return Ri(r,e,t)};function $e(r){return dt(r),q(r<0?0:ke(r)|0)}u.allocUnsafe=function(r){return $e(r)};u.allocUnsafeSlow=function(r){return $e(r)};function bi(r,e){if((typeof e!="string"||e==="")&&(e="utf8"),!u.isEncoding(e))throw new TypeError("Unknown encoding: "+e);let t=ht(r,e)|0,i=q(t),n=i.write(r,e);return n!==t&&(i=i.slice(0,n)),i}function ve(r){let e=r.length<0?0:ke(r.length)|0,t=q(e);for(let i=0;i<e;i+=1)t[i]=r[i]&255;return t}function Ai(r){if(k(r,Uint8Array)){let e=new Uint8Array(r);return Ce(e.buffer,e.byteOffset,e.byteLength)}return ve(r)}function Ce(r,e,t){if(e<0||r.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(r.byteLength<e+(t||0))throw new RangeError('"length" is outside of buffer bounds');let i;return e===void 0&&t===void 0?i=new Uint8Array(r):t===void 0?i=new Uint8Array(r,e):i=new Uint8Array(r,e,t),Object.setPrototypeOf(i,u.prototype),i}function Bi(r){if(u.isBuffer(r)){let e=ke(r.length)|0,t=q(e);return t.length===0||r.copy(t,0,0,e),t}if(r.length!==void 0)return typeof r.length!="number"||Ne(r.length)?q(0):ve(r);if(r.type==="Buffer"&&Array.isArray(r.data))return ve(r.data)}function ke(r){if(r>=ce)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+ce.toString(16)+" bytes");return r|0}function Mi(r){return+r!=r&&(r=0),u.alloc(+r)}u.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==u.prototype};u.compare=function(e,t){if(k(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),k(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let i=e.length,n=t.length;for(let o=0,s=Math.min(i,n);o<s;++o)if(e[o]!==t[o]){i=e[o],n=t[o];break}return i<n?-1:n<i?1:0};u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};u.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return u.alloc(0);let i;if(t===void 0)for(t=0,i=0;i<e.length;++i)t+=e[i].length;let n=u.allocUnsafe(t),o=0;for(i=0;i<e.length;++i){let s=e[i];if(k(s,Uint8Array))o+s.length>n.length?(u.isBuffer(s)||(s=u.from(s)),s.copy(n,o)):Uint8Array.prototype.set.call(n,s,o);else if(u.isBuffer(s))s.copy(n,o);else throw new TypeError('"list" argument must be an Array of Buffers');o+=s.length}return n};function ht(r,e){if(u.isBuffer(r))return r.length;if(ArrayBuffer.isView(r)||k(r,ArrayBuffer))return r.byteLength;if(typeof r!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof r);let t=r.length,i=arguments.length>2&&arguments[2]===!0;if(!i&&t===0)return 0;let n=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":return Te(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return St(r).length;default:if(n)return i?-1:Te(r).length;e=(""+e).toLowerCase(),n=!0}}u.byteLength=ht;function Pi(r,e,t){let i=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(r||(r="utf8");;)switch(r){case"hex":return Ni(this,e,t);case"utf8":case"utf-8":return gt(this,e,t);case"ascii":return ki(this,e,t);case"latin1":case"binary":return qi(this,e,t);case"base64":return Ti(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Di(this,e,t);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),i=!0}}u.prototype._isBuffer=!0;function H(r,e,t){let i=r[e];r[e]=r[t],r[t]=i}u.prototype.swap16=function(){let e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)H(this,t,t+1);return this};u.prototype.swap32=function(){let e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)H(this,t,t+3),H(this,t+1,t+2);return this};u.prototype.swap64=function(){let e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)H(this,t,t+7),H(this,t+1,t+6),H(this,t+2,t+5),H(this,t+3,t+4);return this};u.prototype.toString=function(){let e=this.length;return e===0?"":arguments.length===0?gt(this,0,e):Pi.apply(this,arguments)};u.prototype.toLocaleString=u.prototype.toString;u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:u.compare(this,e)===0};u.prototype.inspect=function(){let e="",t=Z.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"};at&&(u.prototype[at]=u.prototype.inspect);u.prototype.compare=function(e,t,i,n,o){if(k(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(t===void 0&&(t=0),i===void 0&&(i=e?e.length:0),n===void 0&&(n=0),o===void 0&&(o=this.length),t<0||i>e.length||n<0||o>this.length)throw new RangeError("out of range index");if(n>=o&&t>=i)return 0;if(n>=o)return-1;if(t>=i)return 1;if(t>>>=0,i>>>=0,n>>>=0,o>>>=0,this===e)return 0;let s=o-n,c=i-t,p=Math.min(s,c),l=this.slice(n,o),d=e.slice(t,i);for(let h=0;h<p;++h)if(l[h]!==d[h]){s=l[h],c=d[h];break}return s<c?-1:c<s?1:0};function ft(r,e,t,i,n){if(r.length===0)return-1;if(typeof t=="string"?(i=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,Ne(t)&&(t=n?0:r.length-1),t<0&&(t=r.length+t),t>=r.length){if(n)return-1;t=r.length-1}else if(t<0)if(n)t=0;else return-1;if(typeof e=="string"&&(e=u.from(e,i)),u.isBuffer(e))return e.length===0?-1:ut(r,e,t,i,n);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?n?Uint8Array.prototype.indexOf.call(r,e,t):Uint8Array.prototype.lastIndexOf.call(r,e,t):ut(r,[e],t,i,n);throw new TypeError("val must be string, number or Buffer")}function ut(r,e,t,i,n){let o=1,s=r.length,c=e.length;if(i!==void 0&&(i=String(i).toLowerCase(),i==="ucs2"||i==="ucs-2"||i==="utf16le"||i==="utf-16le")){if(r.length<2||e.length<2)return-1;o=2,s/=2,c/=2,t/=2}function p(d,h){return o===1?d[h]:d.readUInt16BE(h*o)}let l;if(n){let d=-1;for(l=t;l<s;l++)if(p(r,l)===p(e,d===-1?0:l-d)){if(d===-1&&(d=l),l-d+1===c)return d*o}else d!==-1&&(l-=l-d),d=-1}else for(t+c>s&&(t=s-c),l=t;l>=0;l--){let d=!0;for(let h=0;h<c;h++)if(p(r,l+h)!==p(e,h)){d=!1;break}if(d)return l}return-1}u.prototype.includes=function(e,t,i){return this.indexOf(e,t,i)!==-1};u.prototype.indexOf=function(e,t,i){return ft(this,e,t,i,!0)};u.prototype.lastIndexOf=function(e,t,i){return ft(this,e,t,i,!1)};function Fi(r,e,t,i){t=Number(t)||0;let n=r.length-t;i?(i=Number(i),i>n&&(i=n)):i=n;let o=e.length;i>o/2&&(i=o/2);let s;for(s=0;s<i;++s){let c=parseInt(e.substr(s*2,2),16);if(Ne(c))return s;r[t+s]=c}return s}function Oi(r,e,t,i){return pe(Te(e,r.length-t),r,t,i)}function Ui(r,e,t,i){return pe(Gi(e),r,t,i)}function vi(r,e,t,i){return pe(St(e),r,t,i)}function Ci(r,e,t,i){return pe(Hi(e,r.length-t),r,t,i)}u.prototype.write=function(e,t,i,n){if(t===void 0)n="utf8",i=this.length,t=0;else if(i===void 0&&typeof t=="string")n=t,i=this.length,t=0;else if(isFinite(t))t=t>>>0,isFinite(i)?(i=i>>>0,n===void 0&&(n="utf8")):(n=i,i=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let o=this.length-t;if((i===void 0||i>o)&&(i=o),e.length>0&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let s=!1;for(;;)switch(n){case"hex":return Fi(this,e,t,i);case"utf8":case"utf-8":return Oi(this,e,t,i);case"ascii":case"latin1":case"binary":return Ui(this,e,t,i);case"base64":return vi(this,e,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ci(this,e,t,i);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}};u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Ti(r,e,t){return e===0&&t===r.length?Ue.fromByteArray(r):Ue.fromByteArray(r.slice(e,t))}function gt(r,e,t){t=Math.min(r.length,t);let i=[],n=e;for(;n<t;){let o=r[n],s=null,c=o>239?4:o>223?3:o>191?2:1;if(n+c<=t){let p,l,d,h;switch(c){case 1:o<128&&(s=o);break;case 2:p=r[n+1],(p&192)===128&&(h=(o&31)<<6|p&63,h>127&&(s=h));break;case 3:p=r[n+1],l=r[n+2],(p&192)===128&&(l&192)===128&&(h=(o&15)<<12|(p&63)<<6|l&63,h>2047&&(h<55296||h>57343)&&(s=h));break;case 4:p=r[n+1],l=r[n+2],d=r[n+3],(p&192)===128&&(l&192)===128&&(d&192)===128&&(h=(o&15)<<18|(p&63)<<12|(l&63)<<6|d&63,h>65535&&h<1114112&&(s=h))}}s===null?(s=65533,c=1):s>65535&&(s-=65536,i.push(s>>>10&1023|55296),s=56320|s&1023),i.push(s),n+=c}return $i(i)}var lt=4096;function $i(r){let e=r.length;if(e<=lt)return String.fromCharCode.apply(String,r);let t="",i=0;for(;i<e;)t+=String.fromCharCode.apply(String,r.slice(i,i+=lt));return t}function ki(r,e,t){let i="";t=Math.min(r.length,t);for(let n=e;n<t;++n)i+=String.fromCharCode(r[n]&127);return i}function qi(r,e,t){let i="";t=Math.min(r.length,t);for(let n=e;n<t;++n)i+=String.fromCharCode(r[n]);return i}function Ni(r,e,t){let i=r.length;(!e||e<0)&&(e=0),(!t||t<0||t>i)&&(t=i);let n="";for(let o=e;o<t;++o)n+=Wi[r[o]];return n}function Di(r,e,t){let i=r.slice(e,t),n="";for(let o=0;o<i.length-1;o+=2)n+=String.fromCharCode(i[o]+i[o+1]*256);return n}u.prototype.slice=function(e,t){let i=this.length;e=~~e,t=t===void 0?i:~~t,e<0?(e+=i,e<0&&(e=0)):e>i&&(e=i),t<0?(t+=i,t<0&&(t=0)):t>i&&(t=i),t<e&&(t=e);let n=this.subarray(e,t);return Object.setPrototypeOf(n,u.prototype),n};function _(r,e,t){if(r%1!==0||r<0)throw new RangeError("offset is not uint");if(r+e>t)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(e,t,i){e=e>>>0,t=t>>>0,i||_(e,t,this.length);let n=this[e],o=1,s=0;for(;++s<t&&(o*=256);)n+=this[e+s]*o;return n};u.prototype.readUintBE=u.prototype.readUIntBE=function(e,t,i){e=e>>>0,t=t>>>0,i||_(e,t,this.length);let n=this[e+--t],o=1;for(;t>0&&(o*=256);)n+=this[e+--t]*o;return n};u.prototype.readUint8=u.prototype.readUInt8=function(e,t){return e=e>>>0,t||_(e,1,this.length),this[e]};u.prototype.readUint16LE=u.prototype.readUInt16LE=function(e,t){return e=e>>>0,t||_(e,2,this.length),this[e]|this[e+1]<<8};u.prototype.readUint16BE=u.prototype.readUInt16BE=function(e,t){return e=e>>>0,t||_(e,2,this.length),this[e]<<8|this[e+1]};u.prototype.readUint32LE=u.prototype.readUInt32LE=function(e,t){return e=e>>>0,t||_(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};u.prototype.readUint32BE=u.prototype.readUInt32BE=function(e,t){return e=e>>>0,t||_(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};u.prototype.readBigUInt64LE=D(function(e){e=e>>>0,X(e,"offset");let t=this[e],i=this[e+7];(t===void 0||i===void 0)&&ie(e,this.length-8);let n=t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24,o=this[++e]+this[++e]*2**8+this[++e]*2**16+i*2**24;return BigInt(n)+(BigInt(o)<<BigInt(32))});u.prototype.readBigUInt64BE=D(function(e){e=e>>>0,X(e,"offset");let t=this[e],i=this[e+7];(t===void 0||i===void 0)&&ie(e,this.length-8);let n=t*2**24+this[++e]*2**16+this[++e]*2**8+this[++e],o=this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+i;return(BigInt(n)<<BigInt(32))+BigInt(o)});u.prototype.readIntLE=function(e,t,i){e=e>>>0,t=t>>>0,i||_(e,t,this.length);let n=this[e],o=1,s=0;for(;++s<t&&(o*=256);)n+=this[e+s]*o;return o*=128,n>=o&&(n-=Math.pow(2,8*t)),n};u.prototype.readIntBE=function(e,t,i){e=e>>>0,t=t>>>0,i||_(e,t,this.length);let n=t,o=1,s=this[e+--n];for(;n>0&&(o*=256);)s+=this[e+--n]*o;return o*=128,s>=o&&(s-=Math.pow(2,8*t)),s};u.prototype.readInt8=function(e,t){return e=e>>>0,t||_(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]};u.prototype.readInt16LE=function(e,t){e=e>>>0,t||_(e,2,this.length);let i=this[e]|this[e+1]<<8;return i&32768?i|4294901760:i};u.prototype.readInt16BE=function(e,t){e=e>>>0,t||_(e,2,this.length);let i=this[e+1]|this[e]<<8;return i&32768?i|4294901760:i};u.prototype.readInt32LE=function(e,t){return e=e>>>0,t||_(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};u.prototype.readInt32BE=function(e,t){return e=e>>>0,t||_(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};u.prototype.readBigInt64LE=D(function(e){e=e>>>0,X(e,"offset");let t=this[e],i=this[e+7];(t===void 0||i===void 0)&&ie(e,this.length-8);let n=this[e+4]+this[e+5]*2**8+this[e+6]*2**16+(i<<24);return(BigInt(n)<<BigInt(32))+BigInt(t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24)});u.prototype.readBigInt64BE=D(function(e){e=e>>>0,X(e,"offset");let t=this[e],i=this[e+7];(t===void 0||i===void 0)&&ie(e,this.length-8);let n=(t<<24)+this[++e]*2**16+this[++e]*2**8+this[++e];return(BigInt(n)<<BigInt(32))+BigInt(this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+i)});u.prototype.readFloatLE=function(e,t){return e=e>>>0,t||_(e,4,this.length),K.read(this,e,!0,23,4)};u.prototype.readFloatBE=function(e,t){return e=e>>>0,t||_(e,4,this.length),K.read(this,e,!1,23,4)};u.prototype.readDoubleLE=function(e,t){return e=e>>>0,t||_(e,8,this.length),K.read(this,e,!0,52,8)};u.prototype.readDoubleBE=function(e,t){return e=e>>>0,t||_(e,8,this.length),K.read(this,e,!1,52,8)};function A(r,e,t,i,n,o){if(!u.isBuffer(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<o)throw new RangeError('"value" argument is out of bounds');if(t+i>r.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(e,t,i,n){if(e=+e,t=t>>>0,i=i>>>0,!n){let c=Math.pow(2,8*i)-1;A(this,e,t,i,c,0)}let o=1,s=0;for(this[t]=e&255;++s<i&&(o*=256);)this[t+s]=e/o&255;return t+i};u.prototype.writeUintBE=u.prototype.writeUIntBE=function(e,t,i,n){if(e=+e,t=t>>>0,i=i>>>0,!n){let c=Math.pow(2,8*i)-1;A(this,e,t,i,c,0)}let o=i-1,s=1;for(this[t+o]=e&255;--o>=0&&(s*=256);)this[t+o]=e/s&255;return t+i};u.prototype.writeUint8=u.prototype.writeUInt8=function(e,t,i){return e=+e,t=t>>>0,i||A(this,e,t,1,255,0),this[t]=e&255,t+1};u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(e,t,i){return e=+e,t=t>>>0,i||A(this,e,t,2,65535,0),this[t]=e&255,this[t+1]=e>>>8,t+2};u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(e,t,i){return e=+e,t=t>>>0,i||A(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=e&255,t+2};u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(e,t,i){return e=+e,t=t>>>0,i||A(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255,t+4};u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(e,t,i){return e=+e,t=t>>>0,i||A(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};function mt(r,e,t,i,n){Et(e,i,n,r,t,7);let o=Number(e&BigInt(4294967295));r[t++]=o,o=o>>8,r[t++]=o,o=o>>8,r[t++]=o,o=o>>8,r[t++]=o;let s=Number(e>>BigInt(32)&BigInt(4294967295));return r[t++]=s,s=s>>8,r[t++]=s,s=s>>8,r[t++]=s,s=s>>8,r[t++]=s,t}function yt(r,e,t,i,n){Et(e,i,n,r,t,7);let o=Number(e&BigInt(4294967295));r[t+7]=o,o=o>>8,r[t+6]=o,o=o>>8,r[t+5]=o,o=o>>8,r[t+4]=o;let s=Number(e>>BigInt(32)&BigInt(4294967295));return r[t+3]=s,s=s>>8,r[t+2]=s,s=s>>8,r[t+1]=s,s=s>>8,r[t]=s,t+8}u.prototype.writeBigUInt64LE=D(function(e,t=0){return mt(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});u.prototype.writeBigUInt64BE=D(function(e,t=0){return yt(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});u.prototype.writeIntLE=function(e,t,i,n){if(e=+e,t=t>>>0,!n){let p=Math.pow(2,8*i-1);A(this,e,t,i,p-1,-p)}let o=0,s=1,c=0;for(this[t]=e&255;++o<i&&(s*=256);)e<0&&c===0&&this[t+o-1]!==0&&(c=1),this[t+o]=(e/s>>0)-c&255;return t+i};u.prototype.writeIntBE=function(e,t,i,n){if(e=+e,t=t>>>0,!n){let p=Math.pow(2,8*i-1);A(this,e,t,i,p-1,-p)}let o=i-1,s=1,c=0;for(this[t+o]=e&255;--o>=0&&(s*=256);)e<0&&c===0&&this[t+o+1]!==0&&(c=1),this[t+o]=(e/s>>0)-c&255;return t+i};u.prototype.writeInt8=function(e,t,i){return e=+e,t=t>>>0,i||A(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=e&255,t+1};u.prototype.writeInt16LE=function(e,t,i){return e=+e,t=t>>>0,i||A(this,e,t,2,32767,-32768),this[t]=e&255,this[t+1]=e>>>8,t+2};u.prototype.writeInt16BE=function(e,t,i){return e=+e,t=t>>>0,i||A(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=e&255,t+2};u.prototype.writeInt32LE=function(e,t,i){return e=+e,t=t>>>0,i||A(this,e,t,4,2147483647,-2147483648),this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4};u.prototype.writeInt32BE=function(e,t,i){return e=+e,t=t>>>0,i||A(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};u.prototype.writeBigInt64LE=D(function(e,t=0){return mt(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});u.prototype.writeBigInt64BE=D(function(e,t=0){return yt(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function wt(r,e,t,i,n,o){if(t+i>r.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function It(r,e,t,i,n){return e=+e,t=t>>>0,n||wt(r,e,t,4,34028234663852886e22,-34028234663852886e22),K.write(r,e,t,i,23,4),t+4}u.prototype.writeFloatLE=function(e,t,i){return It(this,e,t,!0,i)};u.prototype.writeFloatBE=function(e,t,i){return It(this,e,t,!1,i)};function xt(r,e,t,i,n){return e=+e,t=t>>>0,n||wt(r,e,t,8,17976931348623157e292,-17976931348623157e292),K.write(r,e,t,i,52,8),t+8}u.prototype.writeDoubleLE=function(e,t,i){return xt(this,e,t,!0,i)};u.prototype.writeDoubleBE=function(e,t,i){return xt(this,e,t,!1,i)};u.prototype.copy=function(e,t,i,n){if(!u.isBuffer(e))throw new TypeError("argument should be a Buffer");if(i||(i=0),!n&&n!==0&&(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<i&&(n=i),n===i||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-i&&(n=e.length-t+i);let o=n-i;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(t,i,n):Uint8Array.prototype.set.call(e,this.subarray(i,n),t),o};u.prototype.fill=function(e,t,i,n){if(typeof e=="string"){if(typeof t=="string"?(n=t,t=0,i=this.length):typeof i=="string"&&(n=i,i=this.length),n!==void 0&&typeof n!="string")throw new TypeError("encoding must be a string");if(typeof n=="string"&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(e.length===1){let s=e.charCodeAt(0);(n==="utf8"&&s<128||n==="latin1")&&(e=s)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;t=t>>>0,i=i===void 0?this.length:i>>>0,e||(e=0);let o;if(typeof e=="number")for(o=t;o<i;++o)this[o]=e;else{let s=u.isBuffer(e)?e:u.from(e,n),c=s.length;if(c===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<i-t;++o)this[o+t]=s[o%c]}return this};var Q={};function qe(r,e,t){Q[r]=class extends t{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${r}]`,this.stack,delete this.name}get code(){return r}set code(n){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:n,writable:!0})}toString(){return`${this.name} [${r}]: ${this.message}`}}}qe("ERR_BUFFER_OUT_OF_BOUNDS",function(r){return r?`${r} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError);qe("ERR_INVALID_ARG_TYPE",function(r,e){return`The "${r}" argument must be of type number. Received type ${typeof e}`},TypeError);qe("ERR_OUT_OF_RANGE",function(r,e,t){let i=`The value of "${r}" is out of range.`,n=t;return Number.isInteger(t)&&Math.abs(t)>2**32?n=ct(String(t)):typeof t=="bigint"&&(n=String(t),(t>BigInt(2)**BigInt(32)||t<-(BigInt(2)**BigInt(32)))&&(n=ct(n)),n+="n"),i+=` It must be ${e}. Received ${n}`,i},RangeError);function ct(r){let e="",t=r.length,i=r[0]==="-"?1:0;for(;t>=i+4;t-=3)e=`_${r.slice(t-3,t)}${e}`;return`${r.slice(0,t)}${e}`}function Li(r,e,t){X(e,"offset"),(r[e]===void 0||r[e+t]===void 0)&&ie(e,r.length-(t+1))}function Et(r,e,t,i,n,o){if(r>t||r<e){let s=typeof e=="bigint"?"n":"",c;throw o>3?e===0||e===BigInt(0)?c=`>= 0${s} and < 2${s} ** ${(o+1)*8}${s}`:c=`>= -(2${s} ** ${(o+1)*8-1}${s}) and < 2 ** ${(o+1)*8-1}${s}`:c=`>= ${e}${s} and <= ${t}${s}`,new Q.ERR_OUT_OF_RANGE("value",c,r)}Li(i,n,o)}function X(r,e){if(typeof r!="number")throw new Q.ERR_INVALID_ARG_TYPE(e,"number",r)}function ie(r,e,t){throw Math.floor(r)!==r?(X(r,t),new Q.ERR_OUT_OF_RANGE(t||"offset","an integer",r)):e<0?new Q.ERR_BUFFER_OUT_OF_BOUNDS:new Q.ERR_OUT_OF_RANGE(t||"offset",`>= ${t?1:0} and <= ${e}`,r)}var ji=/[^+/0-9A-Za-z-_]/g;function Vi(r){if(r=r.split("=")[0],r=r.trim().replace(ji,""),r.length<2)return"";for(;r.length%4!==0;)r=r+"=";return r}function Te(r,e){e=e||1/0;let t,i=r.length,n=null,o=[];for(let s=0;s<i;++s){if(t=r.charCodeAt(s),t>55295&&t<57344){if(!n){if(t>56319){(e-=3)>-1&&o.push(239,191,189);continue}else if(s+1===i){(e-=3)>-1&&o.push(239,191,189);continue}n=t;continue}if(t<56320){(e-=3)>-1&&o.push(239,191,189),n=t;continue}t=(n-55296<<10|t-56320)+65536}else n&&(e-=3)>-1&&o.push(239,191,189);if(n=null,t<128){if((e-=1)<0)break;o.push(t)}else if(t<2048){if((e-=2)<0)break;o.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;o.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;o.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return o}function Gi(r){let e=[];for(let t=0;t<r.length;++t)e.push(r.charCodeAt(t)&255);return e}function Hi(r,e){let t,i,n,o=[];for(let s=0;s<r.length&&!((e-=2)<0);++s)t=r.charCodeAt(s),i=t>>8,n=t%256,o.push(n),o.push(i);return o}function St(r){return Ue.toByteArray(Vi(r))}function pe(r,e,t,i){let n;for(n=0;n<i&&!(n+t>=e.length||n>=r.length);++n)e[n+t]=r[n];return n}function k(r,e){return r instanceof e||r!=null&&r.constructor!=null&&r.constructor.name!=null&&r.constructor.name===e.name}function Ne(r){return r!==r}var Wi=function(){let r="0123456789abcdef",e=new Array(256);for(let t=0;t<16;++t){let i=t*16;for(let n=0;n<16;++n)e[i+n]=r[t]+r[n]}return e}();function D(r){return typeof BigInt>"u"?Ji:r}function Ji(){throw new Error("BigInt not supported")}});var f,a=fi(()=>{f=_t().Buffer});var Rt=g(de=>{"use strict";a();Object.defineProperty(de,"__esModule",{value:!0});de.Form=void 0;var De=class{reloadForm(){let e=this.__underlying_formId;e&&Application.formDidChange(e)}get requiresExplicitSubmission(){return!1}};de.Form=De});var bt=g(U=>{"use strict";a();Object.defineProperty(U,"__esModule",{value:!0});U.LabelRow=Yi;U.InputRow=zi;U.StepperRow=Qi;U.ToggleRow=Ki;U.SelectRow=Xi;U.ButtonRow=Zi;U.WebViewRow=en;U.NavigationRow=tn;U.OAuthButtonRow=rn;U.DeferredItem=nn;function Yi(r,e){return{...e,id:r,type:"labelRow",isHidden:e.isHidden??!1}}function zi(r,e){return{...e,id:r,type:"inputRow",isHidden:e.isHidden??!1}}function Qi(r,e){return{...e,id:r,type:"stepperRow",isHidden:e.isHidden??!1}}function Ki(r,e){return{...e,id:r,type:"toggleRow",isHidden:e.isHidden??!1}}function Xi(r,e){return{...e,id:r,type:"selectRow",isHidden:e.isHidden??!1}}function Zi(r,e){return{...e,id:r,type:"buttonRow",isHidden:e.isHidden??!1}}function en(r,e){return{...e,id:r,type:"webViewRow",isHidden:e.isHidden??!1}}function tn(r,e){return{...e,id:r,type:"navigationRow",isHidden:e.isHidden??!1}}function rn(r,e){return{...e,id:r,type:"oauthButtonRow",isHidden:e.isHidden??!1}}function nn(r){return r()}});var At=g(Le=>{"use strict";a();Object.defineProperty(Le,"__esModule",{value:!0});Le.Section=on;function on(r,e){let t;return typeof r=="string"?t={id:r}:t=r,{...t,items:e.filter(i=>i)}}});var Bt=g(N=>{"use strict";a();var sn=N&&N.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,i,n)}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),je=N&&N.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&sn(e,r,t)};Object.defineProperty(N,"__esModule",{value:!0});je(Rt(),N);je(bt(),N);je(At(),N)});var Pt=g(Mt=>{"use strict";a();Object.defineProperty(Mt,"__esModule",{value:!0})});var Ot=g(Ft=>{"use strict";a();Object.defineProperty(Ft,"__esModule",{value:!0})});var vt=g(Ut=>{"use strict";a();Object.defineProperty(Ut,"__esModule",{value:!0})});var Tt=g(Ct=>{"use strict";a();Object.defineProperty(Ct,"__esModule",{value:!0})});var kt=g($t=>{"use strict";a();Object.defineProperty($t,"__esModule",{value:!0})});var Nt=g(qt=>{"use strict";a();Object.defineProperty(qt,"__esModule",{value:!0})});var Lt=g(Dt=>{"use strict";a();Object.defineProperty(Dt,"__esModule",{value:!0})});var Vt=g(jt=>{"use strict";a();Object.defineProperty(jt,"__esModule",{value:!0})});var Gt=g(B=>{"use strict";a();var an=B&&B.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,i,n)}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),L=B&&B.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&an(e,r,t)};Object.defineProperty(B,"__esModule",{value:!0});L(Pt(),B);L(Ot(),B);L(vt(),B);L(Tt(),B);L(kt(),B);L(Nt(),B);L(Lt(),B);L(Vt(),B)});var Wt=g(Ht=>{"use strict";a();Object.defineProperty(Ht,"__esModule",{value:!0})});var fe=g(he=>{"use strict";a();Object.defineProperty(he,"__esModule",{value:!0});he.PaperbackInterceptor=void 0;var Ve=class{id;constructor(e){this.id=e}registerInterceptor(){Application.registerInterceptor(this.id,Application.Selector(this,"interceptRequest"),Application.Selector(this,"interceptResponse"))}unregisterInterceptor(){Application.unregisterInterceptor(this.id)}};he.PaperbackInterceptor=Ve});var Yt=g(Jt=>{"use strict";a();Object.defineProperty(Jt,"__esModule",{value:!0})});var Qt=g(zt=>{"use strict";a();Object.defineProperty(zt,"__esModule",{value:!0})});var Kt=g(W=>{"use strict";a();Object.defineProperty(W,"__esModule",{value:!0});W.unlock=W.lock=void 0;var ge={},Ge={},un=async r=>{if(ge[r]){await ge[r],await(0,W.lock)(r);return}ge[r]=new Promise(e=>Ge[r]=()=>{delete ge[r],e()})};W.lock=un;var ln=r=>{Ge[r]&&Ge[r]()};W.unlock=ln});var Zt=g(me=>{"use strict";a();Object.defineProperty(me,"__esModule",{value:!0});me.BasicRateLimiter=void 0;var Xt=Kt(),cn=fe(),He=class extends cn.PaperbackInterceptor{options;promise;currentRequestsMade=0;lastReset=Date.now();imageRegex=new RegExp(/\.(png|gif|jpeg|jpg|webp)(\?|$)/i);constructor(e,t){super(e),this.options=t}async interceptRequest(e){return this.options.ignoreImages&&this.imageRegex.test(e.url)||(await(0,Xt.lock)(this.id),await this.incrementRequestCount(),(0,Xt.unlock)(this.id)),e}async interceptResponse(e,t,i){return i}async incrementRequestCount(){if(await this.promise,(Date.now()-this.lastReset)/1e3>this.options.bufferInterval&&(this.currentRequestsMade=0,this.lastReset=Date.now()),this.currentRequestsMade+=1,this.currentRequestsMade>=this.options.numberOfRequests){let t=(Date.now()-this.lastReset)/1e3;if(t<=this.options.bufferInterval){let i=this.options.bufferInterval-t;console.log(`[BasicRateLimiter] rate limit hit, sleeping for ${i}`),this.promise=Application.sleep(i)}}}};me.BasicRateLimiter=He});var er=g(ye=>{"use strict";a();Object.defineProperty(ye,"__esModule",{value:!0});ye.CloudflareError=void 0;var We=class extends Error{resolutionRequest;type="cloudflareError";constructor(e,t="Cloudflare bypass is required"){super(t),this.resolutionRequest=e}};ye.CloudflareError=We});var ze=g(ne=>{"use strict";a();Object.defineProperty(ne,"__esModule",{value:!0});ne.URL=void 0;ne.parseURL=Je;function Je(r){let e={},t=/^(?:([a-zA-Z][a-zA-Z\d+\-.]*):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?$/,i=r.match(t);if(!i)throw new Error("Invalid URL string provided.");if(i[1]!==void 0&&i[1]!==""&&(e.protocol=i[1]),i[2]!==void 0&&i[2]!==""){let n=i[2],o="",s="",c=n.indexOf("@");if(c!==-1){if(o=n.substring(0,c),s=n.substring(c+1),o!==""){let p=o.indexOf(":");p!==-1?(e.username=o.substring(0,p),e.password=o.substring(p+1)):(e.username=o,e.password="")}}else s=n;if(s!=="")if(s.startsWith("[")){let p=s.indexOf("]");if(p===-1)throw new Error("Invalid IPv6 address in URL update.");e.hostname=s.substring(0,p+1);let l=s.substring(p+1);l.startsWith(":")&&(e.port=l.substring(1))}else{let p=s.lastIndexOf(":");p!==-1&&s.indexOf(":")===p?(e.hostname=s.substring(0,p),e.port=s.substring(p+1)):(e.hostname=s,e.port="")}}if(i[3]!==void 0&&i[3]!==""&&(e.path=i[3].startsWith("/")?i[3]:`/${i[3]}`),i[4]!==void 0){let n={},o=i[4].split("&");for(let s of o){if(!s)continue;let[c,p=""]=s.split("="),l=decodeURIComponent(c),d=decodeURIComponent(p);if(l in n){let h=n[l];Array.isArray(h)?h.push(d):n[l]=[h,d]}else n[l]=d}e.queryItems=n}return i[5]!==void 0&&(e.fragment=i[5]),e}var Ye=class{protocol;hostname;path;username;password;port;queryItems={};fragment;constructor(e){let t=Je(e);if(!t.hostname||!t.protocol)throw new Error("URL Hostname and Protocol are required");this.hostname=t.hostname,this.protocol=t.protocol,this.path=t.path??"",this.username=t.username,this.password=t.password,this.port=t.port,this.queryItems=t.queryItems,this.fragment=t.fragment}toString(){let e=`${this.protocol}://`;if(this.username!==void 0&&this.username!==""&&(e+=this.username,this.password!==void 0&&this.password!==""&&(e+=`:${this.password}`),e+="@"),e+=this.hostname,this.port!==void 0&&this.port!==""&&(e+=`:${this.port}`),this.path!==""&&(e+=this.path.startsWith("/")?this.path:`/${this.path}`),this.queryItems!==void 0){let t=Object.keys(this.queryItems),i=[];if(t.length>0)for(let n of t){let o=this.queryItems[n];if(Array.isArray(o))for(let s of o)i.push(`${encodeURIComponent(n)}=${encodeURIComponent(s)}`);else i.push(`${encodeURIComponent(n)}=${encodeURIComponent(o)}`)}e+=`?${i.join("&")}`}return this.fragment!==void 0&&(e+=`#${this.fragment}`),e}setProtocol(e){if(e==="")throw new Error("Protocol is required");return this.protocol=e,this}setUsername(e){return e===""?this.username=void 0:this.username=e,this}setPassword(e){return e===""?this.password=void 0:this.password=e,this}setHostname(e){if(e==="")throw new Error("Hostname is required");return this.hostname=e,this}setPort(e){return e===""?this.port=void 0:this.port=e,this}setPath(e){return this.path=e.startsWith("/")?e:`/${e}`,this}addPathComponent(e){return this.path=(this.path??"")+(e.startsWith("/")?e:`/${e}`),this}setQueryItems(e){return this.queryItems=e,this}setQueryItem(e,t){return this.queryItems===void 0&&(this.queryItems={}),this.queryItems[e]=t,this}removeQueryItem(e){return delete this.queryItems?.[e],this}setFragment(e){return this.fragment=e,this}update(e){let t;return typeof e=="string"?t=Je(e):t=e,t.protocol!==void 0&&this.setProtocol(t.protocol),t.username!==void 0&&this.setUsername(t.username),t.password!==void 0&&this.setPassword(t.password),t.hostname!==void 0&&this.setHostname(t.hostname),t.port!==void 0&&this.setPort(t.port),t.path!==void 0&&this.setPath(t.path),t.queryItems!==void 0&&this.setQueryItems(t.queryItems),t.fragment!==void 0&&this.setFragment(t.fragment),this}};ne.URL=Ye});var rr=g(we=>{"use strict";a();Object.defineProperty(we,"__esModule",{value:!0});we.CookieStorageInterceptor=void 0;var pn=fe(),dn=ze(),tr="cookie_store_cookies",Qe=class extends pn.PaperbackInterceptor{options;_cookies={};get cookies(){return Object.freeze(Object.values(this._cookies))}set cookies(e){let t={};for(let i of e)this.isCookieExpired(i)||(t[this.cookieIdentifier(i)]=i);this._cookies=t,this.saveCookiesToStorage()}constructor(e){super("cookie_store"),this.options=e,this.loadCookiesFromStorage()}async interceptRequest(e){return e.cookies={...e.cookies??{},...this.cookiesForUrl(e.url).reduce((t,i)=>(t[i.name]=i.value,t),{})},e}async interceptResponse(e,t,i){let n=this._cookies;for(let o of t.cookies){let s=this.cookieIdentifier(o);if(this.isCookieExpired(o)){delete n[s];continue}n[s]=o}return this._cookies=n,this.saveCookiesToStorage(),i}setCookie(e){this.isCookieExpired(e)||(this._cookies[this.cookieIdentifier(e)]=e,this.saveCookiesToStorage())}deleteCookie(e){delete this._cookies[this.cookieIdentifier(e)]}cookiesForUrl(e){console.log("[COMPAT] COOKIES FOR URL");let t=new dn.URL(e),i=t.hostname;if(!i)return[];let n={},o=t.path.startsWith("/")?t.path:`/${t.path}`,s=i.split("."),c=o.split("/");c.shift();let p=this.cookies;for(let l of p){if(this.isCookieExpired(l)){delete this._cookies[this.cookieIdentifier(l)];continue}let h=this.cookieSanitizedDomain(l).split(".");if(s.length<h.length||h.length==0)continue;let x=!0;for(let C=0;C<h.length;C++){let re=h.length-1-C,Y=s.length-1-C;if(h[re]!=s[Y]){x=!1;break}}if(!x)continue;let S=this.cookieSanitizedPath(l),v=S.split("/");v.shift();let F=0;if(o===S)F=Number.MAX_SAFE_INTEGER;else if(v.length===0||S==="/")F=1;else if(o.startsWith(S)&&c.length>=v.length)for(let C=0;C<v.length&&v[C]===c[C];C++)F+=1;F<=0||(n[l.name]?.pathMatches??0)<F&&(n[l.name]={cookie:l,pathMatches:F})}return Object.values(n).map(l=>l.cookie)}cookieIdentifier(e){return`${e.name}-${this.cookieSanitizedDomain(e)}-${this.cookieSanitizedPath(e)}`}cookieSanitizedPath(e){return e.path?.startsWith("/")?e.path:"/"+(e.path??"")}cookieSanitizedDomain(e){return e.domain.replace(/^(www)?\.?/gi,"").toLowerCase()}isCookieExpired(e){return!!(e.expires&&e.expires.getTime()<=Date.now())}loadCookiesFromStorage(){if(this.options.storage=="memory")return;let e=Application.getState(tr);if(!e){this._cookies={};return}let t={};for(let i of e)!i.expires||this.isCookieExpired(i)||(t[this.cookieIdentifier(i)]=i);this._cookies=t}saveCookiesToStorage(){this.options.storage!="memory"&&Application.setState(this.cookies.filter(e=>e.expires),tr)}};we.CookieStorageInterceptor=Qe});var ir=g(Xe=>{"use strict";a();Object.defineProperty(Xe,"__esModule",{value:!0});Xe.createFormState=hn;var Ke=class{form;_value;_selector;constructor(e,t){this.form=e,this._value=t,this._selector=Application.Selector(this,"updateValue")}get value(){return this._value}get selector(){return this._selector}async updateValue(e){this._value=e,this.form.reloadForm()}};function hn(r,e){let t=new Ke(r,e);return[()=>t.value,t.updateValue.bind(t),t.selector]}});var nr=g(R=>{"use strict";a();var fn=R&&R.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,i,n)}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),T=R&&R.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&fn(e,r,t)};Object.defineProperty(R,"__esModule",{value:!0});T(Bt(),R);T(Gt(),R);T(Wt(),R);T(fe(),R);T(Yt(),R);T(Qt(),R);T(Zt(),R);T(er(),R);T(rr(),R);T(ir(),R);T(ze(),R)});var sr=g(or=>{"use strict";a();Object.defineProperty(or,"__esModule",{value:!0})});var ur=g(ar=>{"use strict";a();Object.defineProperty(ar,"__esModule",{value:!0})});var cr=g(lr=>{"use strict";a();Object.defineProperty(lr,"__esModule",{value:!0})});var dr=g(pr=>{"use strict";a();Object.defineProperty(pr,"__esModule",{value:!0})});var fr=g(Ie=>{"use strict";a();Object.defineProperty(Ie,"__esModule",{value:!0});Ie.DiscoverSectionType=void 0;var hr;(function(r){r[r.featured=0]="featured",r[r.simpleCarousel=1]="simpleCarousel",r[r.prominentCarousel=2]="prominentCarousel",r[r.chapterUpdates=3]="chapterUpdates",r[r.genres=4]="genres"})(hr||(Ie.DiscoverSectionType=hr={}))});var mr=g(gr=>{"use strict";a();Object.defineProperty(gr,"__esModule",{value:!0})});var wr=g(yr=>{"use strict";a();Object.defineProperty(yr,"__esModule",{value:!0})});var xr=g(Ir=>{"use strict";a();Object.defineProperty(Ir,"__esModule",{value:!0})});var Er=g(xe=>{"use strict";a();Object.defineProperty(xe,"__esModule",{value:!0});xe.EndOfPageResults=void 0;xe.EndOfPageResults=Object.freeze({items:[],metadata:void 0})});var _r=g(Sr=>{"use strict";a();Object.defineProperty(Sr,"__esModule",{value:!0})});var br=g(Rr=>{"use strict";a();Object.defineProperty(Rr,"__esModule",{value:!0})});var Br=g(Ar=>{"use strict";a();Object.defineProperty(Ar,"__esModule",{value:!0})});var Pr=g(Mr=>{"use strict";a();Object.defineProperty(Mr,"__esModule",{value:!0})});var Or=g(Fr=>{"use strict";a();Object.defineProperty(Fr,"__esModule",{value:!0})});var vr=g(Ur=>{"use strict";a();Object.defineProperty(Ur,"__esModule",{value:!0})});var Tr=g(Cr=>{"use strict";a();Object.defineProperty(Cr,"__esModule",{value:!0})});var qr=g(ee=>{"use strict";a();Object.defineProperty(ee,"__esModule",{value:!0});ee.ContentRating=ee.SourceIntents=void 0;var $r;(function(r){r[r.MANGA_CHAPTERS=1]="MANGA_CHAPTERS",r[r.MANGA_TRACKING=2]="MANGA_TRACKING",r[r.MANGA_PROGRESS=2]="MANGA_PROGRESS",r[r.HOMEPAGE_SECTIONS=4]="HOMEPAGE_SECTIONS",r[r.DISCOVER_SECIONS=4]="DISCOVER_SECIONS",r[r.COLLECTION_MANAGEMENT=8]="COLLECTION_MANAGEMENT",r[r.CLOUDFLARE_BYPASS_REQUIRED=16]="CLOUDFLARE_BYPASS_REQUIRED",r[r.SETTINGS_UI=32]="SETTINGS_UI",r[r.MANGA_SEARCH=64]="MANGA_SEARCH"})($r||(ee.SourceIntents=$r={}));var kr;(function(r){r.EVERYONE="SAFE",r.MATURE="MATURE",r.ADULT="ADULT"})(kr||(ee.ContentRating=kr={}))});var Dr=g(Nr=>{"use strict";a();Object.defineProperty(Nr,"__esModule",{value:!0})});var jr=g(Lr=>{"use strict";a();Object.defineProperty(Lr,"__esModule",{value:!0})});var Gr=g(Vr=>{"use strict";a();Object.defineProperty(Vr,"__esModule",{value:!0})});var Wr=g(Hr=>{"use strict";a();Object.defineProperty(Hr,"__esModule",{value:!0})});var Yr=g(Jr=>{"use strict";a();Object.defineProperty(Jr,"__esModule",{value:!0})});var j=g(m=>{"use strict";a();var gn=m&&m.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,i,n)}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),I=m&&m.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&gn(e,r,t)};Object.defineProperty(m,"__esModule",{value:!0});I(nr(),m);I(sr(),m);I(ur(),m);I(cr(),m);I(dr(),m);I(fr(),m);I(mr(),m);I(j(),m);I(wr(),m);I(xr(),m);I(Er(),m);I(_r(),m);I(br(),m);I(Br(),m);I(Pr(),m);I(Or(),m);I(vr(),m);I(Tr(),m);I(qr(),m);I(Dr(),m);I(jr(),m);I(Gr(),m);I(Wr(),m);I(Yr(),m)});var Pn={};Pe(Pn,{MangaUpdates:()=>Mn,MangaUpdatesExtension:()=>ae});a();var si=z(j(),1);a();var oe=z(j(),1);a();a();var P={};Pe(P,{getContentRating:()=>Kr,parseMangaInfo:()=>wn,unsafeGenres:()=>mn});a();var Ee=z(j(),1),zr=["Adult","Hentai","Smut"],Qr=["Ecchi"],mn=[...zr,...Qr];function yn(r){let e=/\(([a-zA-Z]+)\)/g.exec(r)?.slice(1).map(t=>t.toLowerCase())||[];return e.some(t=>t.includes("ongoing"))?"ONGOING":e.some(t=>t.includes("hiatus"))?"HIATUS":e.some(t=>t.includes("incomplete")||t.includes("discontinued"))?"ABANDONED":e.some(t=>t.includes("complete"))?"COMPLETED":"UNKNOWN"}function Kr(r){let e=(r.genres??[]).map(t=>t.genre).filter(t=>t!=null);return e.some(t=>zr.includes(t))?Ee.ContentRating.ADULT:e.some(t=>Qr.includes(t))?Ee.ContentRating.MATURE:Ee.ContentRating.EVERYONE}function wn(r){let e=[r.title,...(r.associated||[]).map(t=>t?.title)].filter(t=>!!t);return{primaryTitle:e[0]??"",secondaryTitles:e.slice(1),synopsis:r.description||"",thumbnailUrl:r.image?.url?.original||"",author:r.authors?.filter(t=>t?.type==="Author"&&t.name).map(t=>t.name).join(", "),artist:r.authors?.filter(t=>t?.type==="Artist"&&t.name).map(t=>t.name).join(", "),status:yn(r.status||""),rating:r?.bayesian_rating,contentRating:Kr(r)}}var M={};Pe(M,{assertMustBeAuthenticated:()=>En,clearSessionToken:()=>xn,getSessionInfo:()=>ei,getSessionToken:()=>Zr,setSessionToken:()=>In});a();var Xr="[mu-session]",Ze="mu_sessiontoken";function Zr(){let r=Application.getSecureState(Ze);if(r!=null)return String(r)}function In(r){if(typeof r!="string")throw console.log(`${Xr} tried to store invalid mu_sessiontoken: ${String(r)}`),new Error("tried to store invalid mu_sessiontoken");Application.setSecureState(r,Ze)}function xn(){Application.setSecureState(null,Ze)}function ei(){try{let r=Zr();if(r==null)return;let e=r.split(".")[1]||"",t=f.from(e,"base64").toString(),i=JSON.parse(t),n=new Date(i.time_created*1e3);return{sessionId:i.session,username:i.username,loginTime:isNaN(n.getTime())?"-":n.toLocaleString()}}catch(r){console.log(`${Xr} failed to parse session token`),console.log(r);return}}function En(){if(ei()==null)throw new Error("You are not authenticated, please log in through the MangaUpdates settings")}function Sn(r){let e=r;return e.body?.password&&(e={...r,body:{...r.body,password:"***"}}),e.params?.authHash&&(e={...e,params:{...e.params,authHash:"***"}}),JSON.stringify(e)}function ti(r){if(!r)return"<empty>";let e=r;return e?.context?.session_token&&(e={...e,context:{...e.context,session_token:"***"}}),JSON.stringify(e)}async function w(r,e,t,i){let n=`[request] ${e} ${r}`,o=r==="/v1/account/login",s=i??!0,c=t;console.log(`${n} starts (failOnErrorStatus=${s}): ${Sn(c)}`);let p=Object.entries(c.params||{}).filter(b=>b[1]!=null).map(([b,V])=>[`{${b}}`,String(V)]).reduce((b,[V,ui])=>{if(!b.includes(V))throw console.log(`${n} endpoint '${r}' does not contain ${V}!`),new Error("endpoint is missing path parameter");return r.replace(V,String(ui))},r),l=Object.entries(c.query||{}).filter(b=>b[1]!=null).map(([b,V])=>`${b}=${encodeURIComponent(String(V))}`).join("&"),d={accept:"application/json"};if(c.body&&(d["content-type"]="application/json"),!o){M.assertMustBeAuthenticated();let b=M.getSessionToken();d.authorization=`Bearer ${b}`}let h={url:`https://api.mangaupdates.com${p}${l.length>0?"?":""}${l}`,method:e,headers:d,body:c.body?JSON.stringify(c.body):void 0},x=Date.now(),S;try{S=await Application.scheduleRequest(h)}catch(b){if(console.log(`${n} failed: APPLICATION REQUEST ERROR`),console.log(b),s)throw new Error("Request error!");return}let v=Date.now()-x,[F,C]=S,re=`(HTTP ${F.status}, ${v}ms)`,Y;try{Y=JSON.parse(Application.arrayBufferToUTF8String(C))}catch(b){if(console.log(`${n} failed ${re}: BODY PARSING FAILED`),console.log(b),s)throw new Error("Unable to parse response body!");return}let ai=F.status>=200&&F.status<300;if(s&&!ai)throw console.log(`${n} failed ${re}: ${ti(Y)}`),new Error("Request failed!");return console.log(`${n} complete ${re}: ${ti(Y)}`),Y}var Se=class{async getDiscoverSections(){let e={id:"trending-now",title:"Trending Now",type:oe.DiscoverSectionType.featured},t={id:"popular-manga",title:"Popular Manga",type:oe.DiscoverSectionType.simpleCarousel},i={id:"popular-manhwa",title:"Popular Manhwa",type:oe.DiscoverSectionType.simpleCarousel},n={id:"top-100-manga",title:"Top 100 Manga",type:oe.DiscoverSectionType.prominentCarousel};return[e,t,i,n]}async getDiscoverSectionItems(e,t){let i="[getDiscoverSectionItems]",n={page:t??1,perpage:20,exclude_genre:P.unsafeGenres};if(n.page<0)return{items:[],metadata:-1};try{switch(console.log(`${i} starts: ${e.id}, page=${n.page}`),e.id){case"trending-now":n.orderby="week_pos";break;case"popular-manga":n.type=["Manga"],n.orderby="year_pos";break;case"popular-manhwa":n.type=["Manhwa"],n.orderby="year_pos";break;case"top-100-manga":n.orderby="rating",n.perpage=100;break;default:console.log(`${i} unknown section: ${e.id}`),n.orderby="rating";break}let o=await w("/v1/series/search","POST",{body:n},!1),s=(o?.results??[]).map(h=>h.record),c=s.filter(h=>h!=null).map(h=>({...P.parseMangaInfo(h),mangaId:String(h.series_id??"")})).map(h=>({mangaId:h.mangaId,title:h.primaryTitle,imageUrl:h.thumbnailUrl,contentRating:h.contentRating,subtitle:h.status})),p=(n.page-1)*n.perpage+s.length,l=o?.total_hits??0,d=p<l?n.page+1:-1;return console.log(`${i} complete: ${e.id}, page=${n.page} nextPage=${d} results=${s.length} resultsAvailable=${l}`),{items:c,metadata:d}}catch(o){return console.log(`${i} failed: ${e.id}, page=${n.page}`),console.log(o),{items:[],metadata:-1}}}};a();function ri(r,e){e.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(i=>{Object.defineProperty(r.prototype,i,Object.getOwnPropertyDescriptor(t.prototype,i)||Object.create(null))})})}a();var te=class{async getMangaDetails(e){let t="[getMangaDetails]";console.log(`${t} start: ${e}`);let i=await w("/v1/series/{id}","GET",{params:{id:e},query:{}}),n={mangaId:e,mangaInfo:P.parseMangaInfo(i)};return console.log(`${t} complete: ${JSON.stringify(n)}`),n}};a();a();var y=z(j(),1);var et=class extends y.Form{constructor(t,i){super();this.mangaId=t;this.onFormWillClose=i}result=null;formWillDisappear(){this.onFormWillClose(this.result!=null)}getSections(){if(this.result!=null){let t=this.result.status==="success";return[(0,y.Section)("deleted",[(0,y.LabelRow)("deleted",{title:t?"Deleted":this.result.status.toUpperCase(),subtitle:t?"The title has been succesfully deleted from your media list":this.result.reason})])]}return[(0,y.Section)({id:"delete",footer:"WARNING: All media list data will be deleted, this action can not be undone"},[(0,y.ButtonRow)("delete",{title:"Delete",onSelect:Application.Selector(this,"onDelete")})])]}async onDelete(){let t="[onDelete]";try{console.log(`${t} start: ${this.mangaId}`);let i=await w("/v1/lists/series/delete","POST",{body:[parseInt(this.mangaId)]},!1);if(i==null)throw new Error("Failed to delete.");this.result=i,console.log(`${t} complete: ${this.mangaId} - ${JSON.stringify(this.result)}`)}catch(i){console.log(`${t} failed: ${this.mangaId}`),console.log(i),this.result={status:"error",reason:String(i)}}finally{this.reloadForm()}}},_e=class extends y.Form{constructor(t){super();this.mangaId=t}loading=!0;loadingMessage=null;initialState=null;state=null;error=null;get requiresExplicitSubmission(){return!0}formWillAppear(){M.assertMustBeAuthenticated(),this.loadData()}async formDidSubmit(){await this.saveChanges()}getSections(){return this.loading?[(0,y.Section)("loading",[(0,y.LabelRow)("loading",{title:this.loadingMessage??"Loading...",subtitle:this.loadingMessage?"This is caused by MangaUpdates API rate limits. We'll be done as fast as we can.":""})])]:this.error!=null||this.state==null?[(0,y.Section)("error",[(0,y.LabelRow)("error",{title:"Error",subtitle:String(this.error??"Something went wrong.")})])]:[(0,y.Section)({id:"information",header:"Information"},[(0,y.LabelRow)("title",{title:"Title",value:this.state.title}),(0,y.LabelRow)("rating",{title:"Rating",value:this.state.rating}),(0,y.LabelRow)("status",{title:"Status",value:this.state.status})]),(0,y.Section)({id:"progress",header:"Progress"},[(0,y.SelectRow)("list-id",{title:"List",value:this.state.listId!=null?[this.state.listId]:[],options:this.state.listOptions,minItemCount:0,maxItemCount:1,onValueChange:Application.Selector(this,"setList")}),(0,y.StepperRow)("chapter",{title:"Chapters",subtitle:"The highest read chapter number",value:this.state.chapter,minValue:0,maxValue:99999,stepValue:1,loopOver:!1,onValueChange:Application.Selector(this,"setChapter")}),(0,y.StepperRow)("volume",{title:"Volumes",subtitle:"The highest read volume number",value:this.state.volume,minValue:0,maxValue:99999,stepValue:1,loopOver:!1,onValueChange:Application.Selector(this,"setVolume")})]),(0,y.Section)({id:"score",header:"Score"},[(0,y.StepperRow)("score",{title:"Score",subtitle:"Warning: Setting this to 0 will delete the rating from MangaUpdates.",value:this.state.score,minValue:0,maxValue:10,stepValue:.1,loopOver:!1,onValueChange:Application.Selector(this,"setScore")})]),(0,y.Section)({id:"delete",footer:"Delete the title from your media list"},[(0,y.NavigationRow)("delete",{title:"Delete",form:new et(this.mangaId,t=>this.deletionFormClosed(t))})])]}async setList(t){this.state.listId=t[0]}async setChapter(t){this.state.chapter=t,this.reloadForm()}async setVolume(t){this.state.volume=t,this.reloadForm()}async setScore(t){this.state.score=t,this.reloadForm()}deletionFormClosed(t){t&&(this.loading=!0,this.reloadForm(),this.loadData(!0))}async loadData(t=!1){let i="[loadProgressData]";try{console.log(`${i} start: ${this.mangaId}`);let[n,o,s,c]=await Promise.all([w("/v1/series/{id}","GET",{params:{id:this.mangaId},query:{}}),w("/v1/lists","GET",{}),w("/v1/lists/series/{seriesId}","GET",{params:{seriesId:this.mangaId},query:{}},!1),w("/v1/series/{id}/rating","GET",{params:{id:this.mangaId}},!1)]);console.log(`${i} data fetch complete: ${this.mangaId}`);let p=P.parseMangaInfo(n);this.initialState={title:p.primaryTitle,rating:String(p.rating??"-"),status:p.status??"-",listId:s?.list_id!=null?String(s.list_id):void 0,listOptions:o.filter(l=>l.list_id!=null&&l.title!=null).map(l=>({id:String(l.list_id),title:l.title})),chapter:s?.status?.chapter??0,volume:s?.status?.volume??0,score:c?.rating??0},(this.state==null||t)&&(this.state={...this.initialState}),console.log(`${i} complete: ${this.mangaId} - ${JSON.stringify(this.initialState)}`)}catch(n){console.log(`${i} failed: ${this.mangaId}`),console.log(n),this.error=n}finally{this.loading=!1,this.reloadForm()}}async saveChanges(){let t="[submitProgressFormChanges]";try{let i=parseInt(this.mangaId),n=this.initialState,o=this.state;console.log(`${t} start: ${this.mangaId} ${JSON.stringify({initialState:n,submittedState:o})}`);let s=[],c=n.chapter!==o.chapter||n.volume!==o.volume||n.listId!==o.listId,p={body:[{series:{id:i},list_id:parseInt(o.listId??"-1"),status:{volume:o.volume,chapter:o.chapter}}]};c&&(o.listId==null?s.push({message:"Deleting from list",action:async()=>w("/v1/lists/series/delete","POST",{body:[i]})}):n.listId==null?s.push({message:"Adding to list",action:()=>w("/v1/lists/series","POST",p)}):s.push({message:"Updating in list",action:()=>w("/v1/lists/series/update","POST",p)})),n.score!==o.score&&(o.score>0?s.push({message:"Adding rating",action:()=>w("/v1/series/{id}/rating","PUT",{params:{id:i},body:{rating:o.score}})}):s.push({message:"Deleting rating",action:()=>w("/v1/series/{id}/rating","DELETE",{params:{id:i}})}));let l="Applying changes (this might take a few seconds)";for(let[d,{message:h,action:x}]of s.entries())console.log(`${t} action [${d+1}/${s.length}]: ${h}`),s.length>1&&(this.loading=!0,this.loadingMessage=`${l}: ${h}...`,this.reloadForm()),await x(),d<s.length-1&&await Application.sleep(5);console.log(`${t} complete - ${s.length} actions`)}catch(i){throw console.log(`${t} failed`),console.log(i),i}finally{this.loading=!1,this.loadingMessage=null,this.reloadForm()}}};var _n=0,Re=class{async getMangaProgressManagementForm(e){return M.assertMustBeAuthenticated(),new _e(e.mangaId)}async getMangaProgress(e){M.assertMustBeAuthenticated();let t="[getMangaProgress]";console.log(`${t} start: ${e.mangaId}`);let i=await w("/v1/lists/series/{seriesId}","GET",{params:{seriesId:e.mangaId},query:{}},!1);if(i==null)return;let n={chapterId:String(i.status?.chapter??0),sourceManga:e,langCode:"unknown",chapNum:i.status?.chapter??0};return console.log(`${t} complete: ${JSON.stringify({mangaId:e.mangaId,lastReadChapter:n})}`),{sourceManga:e,lastReadChapter:n}}async processChapterReadActionQueue(e){let t="[processChapterReadActionQueue]",i=[],n=[];try{console.log(`${t} starts - received ${e.length} action(s)`);let o=e.reduce((l,d)=>(l[d.sourceManga.mangaId]==null&&(l[d.sourceManga.mangaId]=[]),l[d.sourceManga.mangaId].push(d),l),{}),s=await Promise.all(Object.entries(o).map(([l,d])=>this.parseMangaActions(l,d))),c=[],p=[];for(let l of s)switch(l.type){case"update":c.push(l);break;case"addition":p.push(l);break;case"noop":i.push(...l.ids);break;default:n.push(...l.ids)}if(c.length>0)try{let l=c.map(d=>d.payload);console.log(`${t} applying list updates: ${JSON.stringify(l)}`),await w("/v1/lists/series/update","POST",{body:l}),i.push(...c.flatMap(d=>d.ids))}catch(l){console.log(`${t} list updates failed`),console.log(l),n.push(...c.flatMap(d=>d.ids))}if(c.length>0&&p.length>0&&await Application.sleep(5),p.length>0)try{let l=p.map(d=>d.payload);console.log(`${t} applying list additions: ${JSON.stringify(l)}`),await w("/v1/lists/series","POST",{body:l}),i.push(...p.flatMap(d=>d.ids))}catch(l){console.log(`${t} list additions failed`),console.log(l),n.push(...p.flatMap(d=>d.ids))}return{successfulItems:i,failedItems:n}}catch(o){return console.log(`${t} failed - unhandled error`),console.log(o),{successfulItems:i,failedItems:e.map(s=>s.id).filter(s=>!i.includes(s))}}}async parseMangaActions(e,t){try{let i=parseInt(e),n=await w("/v1/lists/series/{seriesId}","GET",{params:{seriesId:i},query:{}},!1),o=n?.status?.chapter??0,s=n?.status?.volume??0,c=Math.max(...t.map(d=>Math.floor(d.chapterNum||1)),o),p=Math.max(...t.map(d=>Math.floor(d.chapterVolume||1)),s),l;return n==null?l="addition":c>o||p>s?l="update":l="noop",{ids:t.map(d=>d.id),type:l,actions:t,payload:{series:{id:i},list_id:n?.list_id??_n,status:{chapter:c,volume:p}}}}catch(i){return console.log(`[parseAction] parse error: ${JSON.stringify(t)}`),console.log(i),{ids:t.map(n=>n.id),type:"error",actions:t,error:i}}}};a();a();var J={none:"none",title:"title",year:"year",rating:"rating",score:"score",rank:"rank",date_added:"date_added",week_pos:"week_pos",month1_pos:"month1_pos",month3_pos:"month3_pos",month6_pos:"month6_pos",year_pos:"year_pos",list_reading:"list_reading",list_wish:"list_wish",list_complete:"list_complete",list_unfinished:"list_unfinished"};function ii(r){if(r?.id!==J.none)return r!=null&&r.id in J?r.id:void 0}function ni(r){return r.map(e=>{let t=e.record?.series_id,i=e.hit_title??e.record?.title,n=e.record?.image?.url?.original??"",o=e.record!=null?P.getContentRating(e.record):void 0;return!t||!i?(console.log(`[parseSearchResults] ignoring invalid search result: ${JSON.stringify(e)}`),null):{mangaId:String(t),title:i,imageUrl:n,contentRating:o}}).filter(e=>e!==null)}var bn=["Artbook","Doujinshi","Drama CD","Filipino","French","German","Indonesian","Malaysian","Manga","Manhua","Manhwa","Nordic","Novel","OEL","Spanish","Thai","Vietnamese"].map(r=>({id:r.replaceAll(" ","_"),value:r})),An=[{id:"scanlated",value:"Only show completely scanlated manga"},{id:"completed",value:"Only show completed (including oneshots) manga"},{id:"oneshots",value:"Only show one shots"},{id:"no_oneshots",value:"Exclude one shots"},{id:"some_releases",value:"Only show manga with at least one release"},{id:"no_releases",value:"Only show manga with no releases"}];var be=(r,e)=>typeof r=="string"?e==="included"&&r?[r]:[]:Object.entries(r).filter(([t,i])=>i===e).map(([t])=>t),Bn=(r,e)=>{if(!(typeof r=="string"||r[e]==null))return r[e]==="included"},Ae=class extends te{async getSearchFilters(){let[e,t]=await Promise.all([w("/v1/genres","GET",{}),w("/v1/lists","GET",{})]);return[{type:"multiselect",id:"demographic",title:"Demographic",options:e.filter(i=>i.demographic).map(i=>({id:i.genre.replaceAll(" ","_"),value:i.genre})),value:{},allowExclusion:!0,allowEmptySelection:!0,maximum:void 0},{type:"multiselect",id:"genre",title:"Genre",options:e.filter(i=>!i.demographic).map(i=>({id:i.genre.replaceAll(" ","_"),value:i.genre})),value:Object.fromEntries(P.unsafeGenres.map(i=>[i,"excluded"])),allowExclusion:!0,allowEmptySelection:!0,maximum:void 0},{type:"input",id:"category",title:"Categories/Tags",placeholder:'List the categories you want to include, separated by a ","',value:""},{type:"multiselect",id:"licensed",title:"Licensed",options:[{id:"licensed",value:"Licensed"}],value:{},allowExclusion:!0,allowEmptySelection:!0,maximum:void 0},{type:"multiselect",id:"type",title:"Type",options:bn,value:{},allowExclusion:!1,allowEmptySelection:!0,maximum:void 0},{type:"dropdown",id:"status",title:"Status",options:An,value:""},{type:"dropdown",id:"list",title:"List",options:t.map(i=>({id:String(i.list_id),value:`Only show manga on my ${i.title} list`})),value:""}]}async getSortingOptions(e){return[{id:J.none,label:"Default"},{id:J.year,label:"Year"},{id:J.title,label:"Title"},{id:J.rating,label:"Rating"}]}async getSearchResults(e,t,i){let n="[getSearchResults]";console.log(`${n} starts`);try{let o={page:t??1,perpage:25,search:e.title||void 0,orderby:ii(i)};if(o.page<1)return{items:[],metadata:{nextPage:-1}};for(let h of e.filters)switch(h.id){case"demographic":case"genre":o.genre=[...o.genre??[],...be(h.value,"included").map(x=>x.replaceAll("_"," "))],o.exclude_genre=[...o.exclude_genre??[],...be(h.value,"excluded").map(x=>x.replaceAll("_"," "))];break;case"category":break;case"licensed":{let x=Bn(h.value,"licensed");x!=null&&(o.licensed=x?"yes":"no");break}case"type":o.filter_types=be(h.value,"included").map(x=>x.replaceAll("_"," "));break;case"status":o.filters=be(h.value,"included");break;case"list":typeof h.value=="string"&&h.value&&(o.list=h.value);break;default:console.log(`${n} unknown filter: ${h.id}`);break}console.log(`${n} searching: ${JSON.stringify(o)}`);let s=await w("/v1/series/search","POST",{body:o}),c=ni(s.results||[]),l=o.page*o.perpage<(s.total_hits??0)?o.page+1:-1;console.log(`${n} got results: ${JSON.stringify({results:c,nextPage:l})}`);let d={items:c,metadata:l};return console.log(`${n} complete`),d}catch(o){throw console.log(`${n} error`),console.log(o),o}}};a();a();var E=z(j(),1);var tt=class extends E.Form{loginForm={username:"",password:""};get requiresExplicitSubmission(){return!0}formWillAppear(){this.resetFormFields()}formWillDisappear(){this.resetFormFields()}getSections(){return[(0,E.Section)({id:"login-section",header:"Log in",footer:"Use your MangaUpdates username and password to log in. Your password is only used for the initial login and is not stored by this extension."},[(0,E.InputRow)("username-input",{title:"Username",value:this.loginForm.username,onValueChange:Application.Selector(this,"onUsernameChange")}),(0,E.InputRow)("password-input",{title:"Password",value:this.loginForm.password,onValueChange:Application.Selector(this,"onPasswordChange")})])]}async onUsernameChange(e){this.loginForm.username=e}async onPasswordChange(e){this.loginForm.password=e}async formDidSubmit(){let e="[login]";if(console.log(`${e} starts`),!this.loginForm.username||!this.loginForm.password)throw console.error(`${e} login called with invalid credentials: ${JSON.stringify(this.loginForm)}`),new Error("Must provide a username and password!");try{let t=await w("/v1/account/login","PUT",{body:this.loginForm}),i=t.context?.session_token;if(!i)throw console.log(`${e} no session token on response: ${JSON.stringify(t)}`),new Error("no session token on response");M.setSessionToken(i),console.log(`${e} complete`)}catch(t){throw console.log(`${e} failed to log in`),console.log(t),new Error("Login failed!")}}resetFormFields(){this.loginForm={username:"",password:""}}},Be=class extends E.Form{getSections(){let e=M.getSessionInfo();return e==null?this.unauthenticatedView():this.authenticatedView(e)}unauthenticatedView(){return[(0,E.Section)({id:"login-section"},[(0,E.NavigationRow)("login",{title:"Log in",form:new tt})])]}authenticatedView(e){return[(0,E.Section)({id:"profile-section",header:"Profile"},[(0,E.LabelRow)("user-name",{title:"Logged in as",value:e.username}),(0,E.LabelRow)("login-time",{title:"Session started at",value:e.loginTime}),(0,E.LabelRow)("session-id",{title:"Session ID",value:e.sessionId})]),(0,E.Section)({id:"session-section"},[(0,E.ButtonRow)("logout-button",{title:"Log out",onSelect:Application.Selector(this,"logOut")})])]}async logOut(){try{await w("/v1/account/logout","POST",{})}catch(e){throw console.log("[logout] failed to delete session token"),console.log(e),e}M.clearSessionToken(),this.reloadForm()}};var Me=class{async getSettingsForm(){return new Be}};a();var oi=z(j(),1),se=class extends oi.PaperbackInterceptor{async interceptRequest(e){return e}async interceptResponse(e,t,i){return i}};var ae=class{mainRateLimiter=new si.BasicRateLimiter("main",{numberOfRequests:5,bufferInterval:1,ignoreImages:!0});mainInterceptor=new se("main");async initialise(){this.mainRateLimiter.registerInterceptor(),this.mainInterceptor.registerInterceptor()}};ri(ae,[Me,Ae,Se,te,Re]);var Mn=new ae;return gi(Pn);})();
/*! Bundled license information:

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

buffer/index.js:
  (*!
   * The buffer module from node.js, for the browser.
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)
*/
